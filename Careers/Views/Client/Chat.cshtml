
<div id="inputForm">
    <input type="text" id="message" />
    <input type="button" id="sendBtn" value="Отправить" />
</div>
<div id="chatroom"></div>


@section Scripts
{
    <script src="~/lib/signalr/dist/browser/signalr.min.js"></script>

    <script>
        const hubConnection = new signalR.HubConnectionBuilder()
            .withUrl("/hub").build();

        hubConnection.start().then(function () {
            console.log("connected");

            //hubConnection.invoke('getConnectionId')
            //    .then(function (connectionId) {
            //        sessionStorage.setItem('conectionId', connectionId);
            //        // Send the connectionId to controller
            //    }).catch(err => console.error(err.toString()));
        });

        hubConnection.on('Notify', function (message) {
             
            // добавляет элемент для диагностического сообщения
            let notifyElem = document.createElement("b");
            notifyElem.appendChild(document.createTextNode(message));
            let elem = document.createElement("p");
            elem.appendChild(notifyElem);
            var firstElem = document.getElementById("chatroom").firstChild;
            document.getElementById("chatroom").insertBefore(elem, firstElem);
        });
        //hubConnection.on("Send", function (data) {

        //    let elem = document.createElement("p");
        //    elem.appendChild(document.createTextNode(data));
        //    let firstElem = document.getElementById("chatroom").firstChild;
        //    document.getElementById("chatroom").insertBefore(elem, firstElem);

        //});

        hubConnection.on("ReceiveMessage", function (message) {
            let elem = document.createElement("p");
            elem.appendChild(document.createTextNode(message));
            let firstElem = document.getElementById("chatroom").firstChild;
            document.getElementById("chatroom").insertBefore(elem, firstElem);
        });

        document.getElementById("sendBtn").addEventListener("click", function (e) {
            let message = document.getElementById("message").value;
            let userEmail ='clientemail1@gmail.com';
            hubConnection.invoke("Send", userEmail, message);
        });


    </script>
}
