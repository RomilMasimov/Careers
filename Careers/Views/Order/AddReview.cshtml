@model int

<div class="jp_tittle_main_wrapper">
    <div class="jp_tittle_img_overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="jp_tittle_heading_wrapper">
                    <div class="jp_tittle_heading">
                        <h2>Add review</h2>
                    </div>
                    <div class="jp_tittle_breadcrumb_main_wrapper">
                        <div class="jp_tittle_breadcrumb_wrapper">
                            <ul>
                                <li>Home <i class="fa fa-angle-right"></i></li>
                                <li><a asp-area="" asp-controller="Order" asp-action="Index">Orders <i class="fa fa-angle-right"></i></a></li>
                                <li>Add review</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="jp_cp_profile_main_wrapper">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="jp_contact_form_box mt-0">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="jp_contact_inputs_wrapper jp_contact_inputs4_wrapper">
                                <textarea id="text" rows="6" placeholder="Type Your Comment *"></textarea>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="jp_contact_inputs_wrapper jp_contact_inputs4_wrapper">
                                <div class="star-rating">
                                    <span class="fa fa-star-o yes" data-rating="1"></span>
                                    <span class="fa fa-star-o yes" data-rating="2"></span>
                                    <span class="fa fa-star-o yes" data-rating="3"></span>
                                    <span class="fa fa-star-o yes" data-rating="4"></span>
                                    <span class="fa fa-star-o yes" data-rating="5"></span>
                                    <input id="mark" type="hidden" class="rating-value">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="jp_contact_inputs_wrapper jp_contact_inputs4_wrapper">
                                <div id="imageContainer" class="mt-5 d-flex flex-wrap">

                                </div>
                            </div>
                            <div class="jp_adp_choose_resume">
                                <div class="custom-input">
                                    <span><i class="fa fa-upload"></i> &nbsp;Upload Image</span>
                                    <input id="upload" type="file" multiple />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="jp_adp_choose_resume_bottom_btn_post">
                                <button id="submit" type="button" class="jp_btn_default">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">

        let imagesInput = document.querySelector('#images');
        console.dir(imagesInput);

        let Images = [];
        let count = 0;
        $('#upload').change(function () {
            if (this.files && this.files[0]) {
                for (file of this.files) {
                    Images.push(file);
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#imageContainer').append(
                            `<div class="review-image">
                                        <img src="${e.target.result}" class="mr-2 mb-2">
                                        <button data-index="${count++}" type="button"></button>
                                        <i class="close cross"></i>
                                     </div>`);
                    }
                    reader.readAsDataURL(file);
                }
            }
        });

        $('#imageContainer').on('click', '[data-index]', function () {
            let target = $(this);
            let index = target.data('index');
            Images[index] = null;
            target.parent().remove();
        })

        $('#submit').click(function () {
            let postSettings = {
                method: 'POST',
                credentials: 'include',
                mode: 'cors'
            };
            let data = new FormData();
            for (image of Images) {
                data.append('Images', image);
            }
            data.append('OrderId', @Model);
            data.append('Text', $('#text').val());
            data.append('Mark', $('#mark').val());
            postSettings.body = data;

            fetch('/order/addreview', postSettings);
        });
    </script>
}
